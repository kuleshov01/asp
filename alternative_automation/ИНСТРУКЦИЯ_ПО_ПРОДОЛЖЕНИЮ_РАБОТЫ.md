# Инструкция по продолжению работы над проектом автоматизации

## Общая цель проекта

Заменить использование Playwright в проекте автоматизации веб-задач на более эффективный подход, который:
- Работает в фоновом режиме без открытия браузера
- Использует прямые HTTP-запросы для взаимодействия с веб-приложением
- Обеспечивает ту же функциональность, что и оригинальный код на Playwright
- Потребляет меньше ресурсов и работает быстрее

## Текущее состояние проекта

### Оригинальные файлы (в корне проекта):
- `login.py` - основной скрипт с использованием Playwright
- `func.py` - вспомогательные функции для работы с формами
- `exel.py` - функции для работы с Excel
- `config.py` - конфигурационные данные

### Новая реализация (в папке `alternative_automation/`):
- `advanced_http_client.py` - HTTP-клиент для взаимодействия с веб-приложением
- `automation_functions.py` - функции автоматизации, заменяющие Playwright-функции
- `excel_handler.py` - функции для работы с Excel-файлами
- `new_login.py` - основной скрипт с новой реализацией
- `test_automation.py` - тестовый скрипт
- `README.md` - документация

## Проблема, требующая решения

Основной скрипт `new_login.py` не может пройти авторизацию на веб-сайте. Причина:
- Веб-приложение использует ASP.NET WebForms с ViewState, EventValidation и сложной логикой авторизации
- Процесс авторизации включает несколько этапов: заполнение логина/пароля → клик по контейнеру выбора базы → выбор "Социальное обслуживание" → клик по кнопке входа
- Текущая реализация в `advanced_http_client.py` не полностью корректно обрабатывает этот многоступенчатый процесс

## Конкретные задачи для решения

1. **Исправить процесс авторизации в `advanced_http_client.py`**:
   - Правильно обрабатывать клик по `#baseListContainer`
   - Правильно выбирать "Социальное обслуживание" из выпадающего списка
   - Правильно отправлять финальный запрос на вход

2. **Анализ HTTP-трафика**:
   - Необходимо понять, какие именно параметры `__EVENTTARGET`, `__EVENTARGUMENT` и другие скрытые поля используются в реальном процессе
   - Правильно обрабатывать ViewState и EventValidation

3. **Тестирование**:
   - После исправления авторизации протестировать полный цикл работы скрипта
   - Убедиться, что все функции работают корректно

## Технические детали

### Оригинальный процесс авторизации (из `login.py`):
```python
# 1. Заполнение логина
page.fill('#tbUserName', LOGIN)
# 2. Заполнение пароля
page.fill('#tbPassword', PASSWORD)
# 3. Клик по контейнеру выбора базы
page.click('#baseListContainer')
# 4. Ожидание выпадающего списка
page.wait_for_selector('.dropdown')
# 5. Выбор "Социальное обслуживание"
row = page.query_selector('xpath=//table[@id="gvBases"]//tr[contains(., "Социальное обслуживание")]')
row.click()
# 6. Нажатие кнопки "Войти"
page.click('#lbtnLogin')
```

### Текущая реализация в HTTP-клиенте:
- Правильно заполняет логин и пароль
- Пытается обработать клик по контейнеру выбора базы
- Пытается выбрать базу и выполнить вход
- Но процесс авторизации завершается неудачно

## Как продолжить работу

1. Запусти `new_login.py` и проанализируй вывод для понимания текущего поведения
2. Изучи `advanced_http_client.py`, особенно метод `login`
3. Сравни с оригинальным `login.py` чтобы понять все шаги процесса
4. Исправь реализацию авторизации, учитывая особенности ASP.NET WebForms
5. Протестируй изменения
6. После успешной авторизации протестируй полный цикл работы скрипта

## Ожидаемый результат

После исправления код должен:
- Успешно проходить авторизацию на веб-сайте
- Выполнять все операции, которые ранее делались через Playwright
- Работать в фоновом режиме без открытия браузера
- Потреблять меньше ресурсов и работать быстрее оригинального решения